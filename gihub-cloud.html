<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infra Status | Tian Zhihao</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #050505; color: #a1a1aa; font-family: 'JetBrains Mono', monospace; letter-spacing: -0.02em; }
        .grid-bg { background-image: radial-gradient(#1a1a1a 1px, transparent 1px); background-size: 30px 30px; }
        .tech-card { background: rgba(13, 17, 23, 0.9); border: 1px solid #30363d; position: relative; }
        .tech-card:hover { border-color: #58a6ff; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .glow-green { box-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }
        .terminal-text { color: #58a6ff; font-size: 11px; }
        code { color: #e6edf3; }
    </style>
</head>
<body class="grid-bg min-h-screen">

    <div class="max-w-6xl mx-auto px-6 py-16">
        <nav class="flex justify-between items-center mb-16 border-b border-zinc-800 pb-6">
            <div class="text-white font-bold text-xl tracking-tighter">
                SYSTEM<span class="text-blue-500">_INFRA</span>
            </div>
            <div class="flex items-center space-x-4 text-[10px]">
                <span class="flex items-center gap-2">
                    <span class="status-dot bg-green-500 glow-green"></span>
                    <span class="text-zinc-400 uppercase">Edge Nodes: Active</span>
                </span>
            </div>
        </nav>

        <header class="mb-20">
            <h1 class="text-5xl font-extrabold text-white mb-6 tracking-tight">
                存储与分发<span class="text-zinc-600">架构协议</span>
            </h1>
            <p class="text-gray-500 max-w-2xl leading-relaxed">
                基于 GitHub REST API 进行文件写入，通过 Netlify Webhook 触发全球边缘节点同步。实现静态资源（Images/Assets）的原子化管理与持久化缓存。
            </p>
        </header>

        <section class="mb-20">
            <div class="flex items-center gap-3 mb-8">
                <span class="text-blue-500 text-xl">#</span>
                <h2 class="text-white text-xl font-bold">节点监控 / Live Deploys</h2>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="tech-card p-6 rounded-lg">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h3 class="text-white font-bold mb-1">Personal Blog</h3>
                            <p class="terminal-text">blog.lnova.top</p>
                        </div>
                        <img src="https://api.netlify.com/api/v1/badges/095f76dd-cd72-4c23-8c02-b3c7d97d181d/deploy-status" alt="Deploy Status" class="h-5">
                    </div>
                    
                    <div class="space-y-4 text-[11px]">
                        <div class="flex justify-between">
                            <span class="text-zinc-500 uppercase">Current State</span>
                            <span id="blog-state" class="text-green-500 font-bold italic">Checking...</span>
                        </div>
                        <div class="flex justify-between border-t border-zinc-800 pt-2">
                            <span class="text-zinc-500 uppercase">Last Build Time</span>
                            <span id="blog-time" class="text-zinc-300">-- : -- : --</span>
                        </div>
                        <div class="flex justify-between border-t border-zinc-800 pt-2">
                            <span class="text-zinc-500 uppercase">Commit Hash</span>
                            <span id="blog-commit" class="text-blue-400">#0000000</span>
                        </div>
                    </div>
                </div>

                <div class="tech-card p-6 rounded-lg">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h3 class="text-white font-bold mb-1">Image Infrastructure</h3>
                            <p class="terminal-text">github.lnova.top</p>
                        </div>
                        <img src="https://api.netlify.com/api/v1/badges/285ca6ef-0885-4899-81d2-dd54b34234a8/deploy-status" alt="Deploy Status" class="h-5">
                    </div>
                    
                    <div class="space-y-4 text-[11px]">
                        <div class="flex justify-between">
                            <span class="text-zinc-500 uppercase">Current State</span>
                            <span id="img-state" class="text-blue-500 font-bold italic">Checking...</span>
                        </div>
                        <div class="flex justify-between border-t border-zinc-800 pt-2">
                            <span class="text-zinc-500 uppercase">Last Build Time</span>
                            <span id="img-time" class="text-zinc-300">-- : -- : --</span>
                        </div>
                        <div class="flex justify-between border-t border-zinc-800 pt-2">
                            <span class="text-zinc-500 uppercase">Commit Hash</span>
                            <span id="img-commit" class="text-blue-400">#0000000</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-20">
            <h3 class="text-white text-xl font-bold mb-10 flex items-center">
                <span class="text-blue-500 mr-2">/</span> 数据流拓扑
            </h3>
            <div class="tech-card p-8 rounded-lg overflow-hidden border-dashed">
                <div class="grid md:grid-cols-3 gap-12 relative">
                    <div class="relative z-10">
                        <div class="text-[10px] text-zinc-500 mb-4 font-mono underline">PHASE_01: INPUT</div>
                        <h4 class="text-white font-bold mb-2">Web Controller</h4>
                        <p class="text-xs text-zinc-500 leading-relaxed">通过 REST API 注入二进制数据流。支持对 <code>main</code> 分支的直接提交与 PR 验证。</p>
                    </div>
                    <div class="relative z-10">
                        <div class="text-[10px] text-zinc-500 mb-4 font-mono underline">PHASE_02: CI/CD</div>
                        <h4 class="text-white font-bold mb-2">GitHub Webhook</h4>
                        <p class="text-xs text-zinc-500 leading-relaxed">检测 <code>push</code> 事件，触发 Netlify 后台构建。执行 <code>hugo --minify</code> 或静态同步。</p>
                    </div>
                    <div class="relative z-10">
                        <div class="text-[10px] text-zinc-500 mb-4 font-mono underline">PHASE_03: EDGE</div>
                        <h4 class="text-white font-bold mb-2">Global CDN</h4>
                        <p class="text-xs text-zinc-500 leading-relaxed">内容分发至 Anycast IP。配合浏览器 <code>Service Workers</code> 实现二次加速。</p>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <div class="bg-black rounded p-4 font-mono text-[10px] border border-zinc-900 leading-loose">
                <div class="text-zinc-600">[SYSTEM] Initialization sequences completed...</div>
                <div class="text-zinc-600">[NETLIFY] Listening for upstream Webhooks...</div>
                <div class="text-green-900 font-bold">[READY] All distribution channels are online.</div>
            </div>
        </section>
    </div>

    <script>
        async function updateStatus(siteId, stateId, timeId, commitId) {
            try {
                // 调用 Netlify 公开的部署列表接口
                const res = await fetch(`https://api.netlify.com/api/v1/sites/${siteId}/deploys`);
                const data = await res.json();
                const last = data[0];

                document.getElementById(stateId).innerText = last.state.toUpperCase();
                document.getElementById(timeId).innerText = new Date(last.published_at).toLocaleString('zh-CN', {timeZone:'Asia/Shanghai'});
                document.getElementById(commitId).innerText = last.commit_ref ? last.commit_ref.substring(0, 7) : 'MANUAL';
            } catch (err) {
                document.getElementById(stateId).innerText = "ERROR";
            }
        }

        // 重要：请在此处替换你的 Netlify API ID (Site ID)
        updateStatus('095f76dd-cd72-4c23-8c02-b3c7d97d181d', 'blog-state', 'blog-time', 'blog-commit');
        updateStatus('285ca6ef-0885-4899-81d2-dd54b34234a8', 'img-state', 'img-time', 'img-commit');
    </script>
</body>
</html>